















<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2020-09-29 07:02:11 -0600">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/syntax.css" />
    <link rel="license" href="#license-info" />

    



    <!-- Favicons for everyone -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../assets/favicons/swc/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/favicons/swc/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/favicons/swc/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/favicons/swc/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../assets/favicons/swc/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../assets/favicons/swc/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../assets/favicons/swc/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../assets/favicons/swc/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="Software Carpentry - CESM Troubleshooting"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="../assets/favicons/swc/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="../assets/favicons/swc/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="../assets/favicons/swc/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="../assets/favicons/swc/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="../assets/favicons/swc/mstile-310x310.png" />


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

  <title>
  History and Setup for Diagnostics &ndash; CESM Troubleshooting
  </title>  

  </head>
  <body>

    







    <div class="container">
      
















  
  










<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      <a class="navbar-brand" href="../index.html">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

        
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            
            <li><a href="../01-Our-Experiments-Troubleshooting/index.html">Our Experiments</a></li>
            
            
            <li><a href="../02-history-setup/index.html">History and Setup for Diagnostics</a></li>
            
            
            <li><a href="../03-diagnostics/index.html">Model Diagnostics Packages</a></li>
            
            
            <li><a href="../04-postprocessing/index.html">Postprocessing</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../aio/index.html">All in one page (Beta)</a></li>
          </ul>
        </li>

	
	
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../reference.html">Reference</a></li>
            
            
            <li><a href="../about/index.html">About</a></li>
            
            
            <li><a href="../discuss/index.html">Discussion</a></li>
            
            
            <li><a href="../figures/index.html">Figures</a></li>
            
            
            <li><a href="../guide/index.html">Instructor Notes</a></li>
            
          </ul>
        </li>
	

      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>




























  
  











<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../01-Our-Experiments-Troubleshooting/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
    <h3 class="maintitle"><a href="../">CESM Troubleshooting</a></h3>
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../03-diagnostics/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>

<article>
<div class="row">
  <div class="col-md-1">
  </div>
  <div class="col-md-10">
    <h1 class="maintitle">History and Setup for Diagnostics</h1>
  </div>
  <div class="col-md-1">
  </div>
</div>












<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 0 min
      <br/>
      <strong>Exercises:</strong> 0 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>What is in our history files?</p>
</li>
	
	<li><p>How do I setup to run the postprocessing and diagnostics packages</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
      </ul>
    </div>
  </div>

</blockquote>

<p>We will now return to the output from our 4-year case.  Let’s go to the atmospheric history directory for our case.
If your 4-year case did not run to completion, you are welcome to look at mine.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /glade/scratch/kpegion/archive/test1/atm/hist
</code></pre></div></div>

<h3 id="history-vs-timeseries-files">History vs. Timeseries Files</h3>

<dl>
  <dt>History files</dt>
  <dd>contain all of the variables for a componenet for a particular frequency and are output directly by the model.</dd>
  <dt>Timeseries files</dt>
  <dd>usually span a number of timesteps and contain only one major variable.  They are created offline.</dd>
</dl>

<p>When NCAR provides output from their model simulations publicly, they typically provide timeseries files for a select set of variables.</p>

<p>Examples:</p>

<p>A history file: <code class="language-plaintext highlighter-rouge">f40_test.cam.h0.1993-11.nc</code></p>
<ul>
  <li>1 monthly timestep (Nov 1993)</li>
  <li>200+ CAM varaibles</li>
</ul>

<p>A timeseries file: <code class="language-plaintext highlighter-rouge">f40_test.cam.h0.PSL.199001-199912.nc</code></p>
<ul>
  <li>120 monthly timesteps (Jan 1990-Dec1999)</li>
  <li>1 CAM variable (PSL), along with coordinate variables like <code class="language-plaintext highlighter-rouge">time</code>,<code class="language-plaintext highlighter-rouge">lat</code>,’lon`,etc.</li>
</ul>

<h3 id="cesm-time-variable">CESM Time Variable</h3>

<p>The time coordinate variable in CESM history and timeseries files represents <em>the end</em> of the averaging period for variables that are averages.  The time that gets resolved when the data are read in does not match the date in the filename. For monthly averaged data, the filename is correct.  This can be a source of much confusion.</p>

<p>Example: <code class="language-plaintext highlighter-rouge">test1.cam.h0.0001-05.nc</code></p>
<ul>
  <li>This is a history file for may of year one of our run.</li>
  <li>When you read in this file, the first time is resolved as: <code class="language-plaintext highlighter-rouge">0001-06-01</code>.  This means that Jun 1 of year 0001 is the end of the averaging period and the data contains the average for May of year 1.</li>
  <li>To verify the averaging period in the files, consult the <code class="language-plaintext highlighter-rouge">time_bnds</code>, <code class="language-plaintext highlighter-rouge">time_bound</code>, or <code class="language-plaintext highlighter-rouge">time_bounds</code> variable. Always check!!!!</li>
  <li>This is a convention used by CESM to allow averaged and instantaneous variables to be stored in the same file.</li>
</ul>

<h3 id="postprocessing">Postprocessing</h3>

<p>The process of going from <code class="language-plaintext highlighter-rouge">history</code> files to <code class="language-plaintext highlighter-rouge">timeseries</code> files and to convert 3D atmospheric data from the model coordinate system to selected pressure levels. We will learn how to use the CESM Postprocessing Tools which are primarily written in NCAR Command Language (NCL).  NCL is in the process of being converted to Python, but for now, we can use the preprepared NCL scripts without having to know too much NCL.</p>

<h3 id="diagnostics-packages">Diagnostics Packages</h3>

<p>There is a large suite of postprocessing and diagnostic packages developed by NCAR using a combination of NCL and Python scripts that automatically generate a variety of different kinds of plots from model output files and used to evaluate a simulation. They all compute a series of pre-defined metrics and display the plots via a website.</p>

<p>There are five main diagnostics packages:</p>
<ol>
  <li>Atmosphere</li>
  <li>Ice</li>
  <li>Land</li>
  <li>Ocean</li>
  <li>Climate Variability and Diagnostics Package (CVDP)</li>
</ol>

<h3 id="postprocessing-and-diagnostics-packages-setup">Postprocessing and Diagnostics Packages Setup</h3>

<p>We will setup everything necessary for you to be able to run the postprocessing and diagnostics packages on the NCAR computers.</p>

<h4 id="setup-your-profile-or-tcshrc">Setup your <code class="language-plaintext highlighter-rouge">.profile</code> or <code class="language-plaintext highlighter-rouge">.tcshrc</code></h4>

<p>If you have never setup a <code class="language-plaintext highlighter-rouge">.profile</code> or <code class="language-plaintext highlighter-rouge">.tcshrc</code> on cheyenne:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cp</span> /glade/u/home/kpegion/clim670/profile.sample ~/.profile
</code></pre></div></div>

<p>If you already have a <code class="language-plaintext highlighter-rouge">.profile</code> (bash users) or a <code class="language-plaintext highlighter-rouge">.tcshrc</code> (tcsh users), look at the corresponding file and add the necessary items from the sample file to your file.  The sample files are located in: <code class="language-plaintext highlighter-rouge">~kpegion/clim670/</code></p>

<h4 id="copy-the-post-processing-scripts-to-the-correct-location">Copy the post-processing scripts to the correct location:</h4>

<p>Go to your home directory:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span>
</code></pre></div></div>

<p>Create a scripts directory and go to it:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>scripts
<span class="nb">cd </span>scripts
</code></pre></div></div>

<p>Copy all files needed:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cp</span> <span class="nt">-R</span> /glade/u/home/asphilli/CESM_tutorial/<span class="k">*</span> <span class="nb">.</span>
</code></pre></div></div>

<p>You may get an error about being able to copy a particular file. You can ignore the error.</p>

<p>Put the configuration file into the correct location:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mv </span>hluresfile ../.hluresfile
</code></pre></div></div>

<h4 id="setup-the-python-environment-for-the-cesm-diagnostics-and-post-processing-scripts">Setup the python environment for the CESM diagnostics and post-processing scripts</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cesm_pp_activate 
</code></pre></div></div>

<h4 id="create-a-directory-for-the-cesm-postprocessing-code">Create a directory for the CESM postprocessing code:</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> /glade/scratch/kpegion/cesm-postprocess
</code></pre></div></div>

<h4 id="run-the-postprocessing-using-create_postprocess-and-tell-it-the-name-of-your-4-year-case">Run the postprocessing using <code class="language-plaintext highlighter-rouge">create_postprocess</code> and tell it the name of your 4-year case</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>create_postprocess <span class="nt">--caseroot</span> /glade/scratch/kpegion/cesm-postprocess/test1
</code></pre></div></div>

<h4 id="go-to-the-postprocessing-directory">Go to the postprocessing directory:</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /glade/scratch/kpegion/cesm-postprocess/test1
</code></pre></div></div>

<h4 id="set-the-location-of-the-model-data">Set the location of the model data:</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./pp_config <span class="nt">--set</span> <span class="nv">DOUT_S_ROOT</span><span class="o">=</span>/glade/scratch/kpegion/archive/test1
</code></pre></div></div>

<h4 id="tell-the-diagnostics-what-kinds-of-grids-to-expect-our-version-uses">Tell the diagnostics what kinds of grids to expect, our version uses:</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./pp_config <span class="nt">--set</span> <span class="nv">ATM_GRID</span><span class="o">=</span>1.9x2.5
./pp_config <span class="nt">--set</span> <span class="nv">LND_GRID</span><span class="o">=</span>1.9x2.5
./pp_config <span class="nt">--set</span> <span class="nv">ICE_GRID</span><span class="o">=</span>gx1v7
./pp_config <span class="nt">--set</span> <span class="nv">OCN_GRID</span><span class="o">=</span>gx1v7
./pp_config <span class="nt">--set</span> <span class="nv">ICE_NX</span><span class="o">=</span>320
./pp_config <span class="nt">--set</span> <span class="nv">ICE_NY</span><span class="o">=</span>384
</code></pre></div></div>





<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
  </ul>
</blockquote>

</article>



























  
  











<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../01-Our-Experiments-Troubleshooting/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../03-diagnostics/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


      
      






<footer>
  <div class="row">
    <div class="col-md-6 help-links" align="right">
    </div>
  </div>
  <div class="row">
    <div class="col-md-12" align="center">
      Using <a href="https://github.com/carpentries/styles/">The Carpentries style</a>
      version <a href="https://github.com/carpentries/styles/releases/tag/v9.5.3">9.5.3</a>.
    </div>
  </div>
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
